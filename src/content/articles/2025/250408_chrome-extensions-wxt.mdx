---
title: Chromeæ‹¡å¼µæ©Ÿèƒ½ã‚’ç°¡å˜ã«ä½œæˆã§ãã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€ŒWXTã€ã‚’ä½¿ã£ã¦ã€åˆã‚ã¦æ‹¡å¼µæ©Ÿèƒ½ã‚’è‡ªä½œã—ã¦ã¿ãŸ
slug: chrome-extensions-wxt
pubDate: '2025-04-08'
image: ../../../assets/images/chrome-extensions-wxt.jpg
ogp: 'images/ogp/chrome-extensions-wxt.jpg'
category: Web
tags:
  - Chromeæ‹¡å¼µæ©Ÿèƒ½
description: Chromeæ‹¡å¼µæ©Ÿèƒ½ã‚’ç°¡å˜ã«ä½œæˆã§ãã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€ŒWXTã€ã‚’ä½¿ã£ã¦ã€åˆã‚ã¦æ‹¡å¼µæ©Ÿèƒ½ã‚’è‡ªä½œã—ã¦ã¿ãŸ
relatedPosts:
  - recommended-book-for-frontend-devs
---
import AmazonLink from '../../../components/markdown/AmazonLink.astro';

## ã¯ã˜ã‚ã«

ã¨ã‚ã‚‹ç†ç”±ã§Chromeã®æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½œã‚ŠãŸããªã‚Šã€ã©ã†ã›ãªã‚‰Reactã§ä½œã‚ŠãŸã„ãªã¨èª¿ã¹ã¦ã¿ãŸã¨ã“ã‚[WXT](https://wxt.dev/)ã¨ã„ã†ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã†ã¨ç°¡å˜ã«ä½œæˆã§ããŸã®ã§ã€ä»Šå›ã¯ãã®ä½œæˆæ–¹æ³•ã‚’ã¾ã¨ã‚ã¦ã„ãã¾ã™ã€‚

ä»Šå›ã€ä¾‹ã§ä½œã‚‹æ‹¡å¼µæ©Ÿèƒ½ã®æ©Ÿèƒ½ã¯ã€Amazonã®å•†å“ãƒšãƒ¼ã‚¸ã‹ã‚‰å•†å“ã®æƒ…å ±ã¨ç”»åƒã‚’å–å¾—ã—ã¦ã‚³ãƒ”ãƒ¼ã§ãã‚‹ã‚ˆã†ã«ã—ãŸæ©Ÿèƒ½ã§ã™ã€‚ä½œã£ãŸã‚‚ã®ã®ãƒªãƒã‚¸ãƒˆãƒªã¯ğŸ‘‡ã“ã¡ã‚‰ã«ãªã‚Šã¾ã™ã€‚

https://github.com/nono-k/chrome-extensions-amazon-scraping

## WXTã¨ã¯

WXTã¯ã€Chromeã‚„Firefoxãªã©è¤‡æ•°ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«å¯¾å¿œã—ãŸæ‹¡å¼µæ©Ÿèƒ½ã‚’ç°¡å˜ã«ä½œæˆã§ãã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚Vanila JSã¯ã‚‚ã¡ã‚ã‚“ã€Reactãƒ»Vueãƒ»Svelteãƒ»Solidãªã©ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã£ã¦æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://wxt.dev/

## WXTã®å°å…¥

npmã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ä»»æ„ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
npx wxt@latest init <project-name>
```

ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œå¾Œã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã†ã‹ã‚„ã©ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ä½¿ã†ã‹ã‚’èã‹ã‚Œã‚‹ã®ã§ã€ä»Šå›ã¯reactã¨npmã‚’é¸æŠã—ã¾ã™ã€‚

ä¸Šè¨˜å®Œäº†ã—ãŸã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç§»å‹•ã—ã¦`npm install`ã‚’å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ã€‚

## é–‹ç™ºãƒ–ãƒ©ã‚¦ã‚¶ã®èµ·å‹•

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‰æ—¢ã«popupä»¥ä¸‹ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã®ã§ã€`npm run dev`ã™ã‚‹ã¨é–‹ç™ºãƒ–ãƒ©ã‚¦ã‚¶ãŒèµ·å‹•ã—å‹•ä½œã‚’ç¢ºèªã§ãã¾ã™ã€‚Reactã§ãŠãªã˜ã¿ã®ã‚«ã‚¦ãƒ³ãƒˆAppãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

npm run devã§èµ·å‹•ã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ã¯æ‹¡å¼µæ©Ÿèƒ½ãŒå…¨ã¦å¤–ã•ã‚ŒãŸçŠ¶æ…‹ã®ã‚‚ã®ãŒèµ·å‹•ã™ã‚‹ã®ãŒè‰¯ã„ã§ã™ã­ã€‚
ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã‚‚åŠ¹ãã®ã§ã€ä¿å­˜ã—ãŸã‚‰å³åº§ã«åæ˜ ã•ã‚Œã‚‹ã®ã§ã¨ã¦ã‚‚ä¾¿åˆ©ã§ã™ã€‚

## Tailwind CSSã®å°å…¥

CSSã‚’æ¥½ã«æ›¸ããŸã‚ã«Tailwind CSSã‚’å°å…¥ã—ã¾ã—ã‚‡ã†ï¼
ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
npm install tailwindcss @tailwindcss/vite
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããŸã‚‰ã€`wxt.config.ts`ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ts {6-8} title="wxt.config.ts"
import { defineConfig } from 'wxt';
import tailwindcss from '@tailwindcss/vite';

export default defineConfig({
  // ...
  vite: () => ({
    plugins: [tailwidcss()],
  })
})
```

`assets/tailwind.css`ã‚’ä½œæˆã—ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

```css title="assets/tailwind.css"
@import "tailwindcss";
```

`entrypoints/popup/index.html`ã§å…ˆã»ã©ä½œæˆã—ãŸtailwind.cssã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã§ã€Tailwind CSSã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚Tailwind CSSãŒåæ˜ ã•ã‚Œã‚‹ã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼

```html {8} title="entrypoints/popup/index.html"
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Default Popup Title</title>
    <meta name="manifest.type" content="browser_action" />
    <link rel="stylesheet" href="../../assets/tailwind.css" />
  </head>
  <body>
    <h1 class="text-2xl text-red-500">Hellow World</h1>
  </body>
</html>
```

ãã‚Œã§ã¯ã€ä»Šå›ä½œæˆã—ãŸAmazonã®å•†å“æƒ…å ±ã‚’å–å¾—ã™ã‚‹æ‹¡å¼µæ©Ÿèƒ½ã®ä½œã‚Šæ–¹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

---

## Amazonã®å•†å“æƒ…å ±ã‚’å–å¾—ã™ã‚‹æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½œã‚‹

ã“ã®ãƒ–ãƒ­ã‚°ã§ã¯Amazonã®ãƒªãƒ³ã‚¯ã‚’è¼‰ã›ã‚‹ãŸã‚ã«ã€Astroã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’MDXã§æ›¸ã„ã¦è¡¨ç¤ºã•ã›ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã¯Amazonå•†å“ãƒšãƒ¼ã‚¸ã®ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¾‹ã§ã™ã€‚

```mdx title="MDXã§ã®AmazonLinkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ›¸ãæ–¹"
<AmazonLink
  imageId=""
  linkId=""
  title=""
  author=""
/>
```

<details>
<summary>AmazonLinkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸­èº«</summary>
<div>
AmazonLinkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸­èº«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```astro title="AmazonLinkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ"
---
const { imageId, linkId, title, author } = Astro.props;
---

<div class="amazon">
  <a href=`https://amzn.to/${linkId}` class="amazon__link -img" target="_blank">
    <img src=`https://m.media-amazon.com/images/I/${imageId}.jpg` alt=`${title}` width="170" height="220" loading="lazy">
  </a>
  <a href=`https://amzn.to/${linkId}` class="amazon__link -text" target="_blank">
    <span class="title">{title}</span>
    <span class="author">è‘—è€…: {author}</span>
    <span class="btn">Amazon.co.jpã§è³¼å…¥ã™ã‚‹</span>
  </a>
</div>
```

ãƒªãƒ³ã‚¯ã¯çŸ­ç¸®ãƒªãƒ³ã‚¯ãŒ`https://amzn.to/`ã§å§‹ã¾ã‚‹ã®ã§ã€ãã®å¾Œã«IDã‚’ä»˜ã‘ã‚‹ã“ã¨ã§æ©Ÿèƒ½ã—ã¾ã™ã€‚ç”»åƒã«é–¢ã—ã¦ã‚‚åŒæ§˜ã«ã€ç”»åƒã®IDã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
</div>
</details>

ã“ã®ã‚ˆã†ã«ã€ã„ã¡ã„ã¡å•†å“ãƒšãƒ¼ã‚¸ã«é£›ã‚“ã§ã‚¿ã‚¤ãƒˆãƒ«ã‚„ç”»åƒURLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦è²¼ã‚Šä»˜ã‘ã¦ã„ãŸã®ã§é¢å€’ã§ã—ãŸã€‚ãªã®ã§ã€ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã‚‰ä¸€ç™ºã§å•†å“æƒ…å ±ã‚’å–å¾—ã—ã¦ã‚³ãƒ”ãƒ¼ã§ãã‚‹ã‚ˆã†ãªæ‹¡å¼µæ©Ÿèƒ½ã‚’ä½œæˆã—ã¾ã™ã€‚

å®Œæˆå›³ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![Amazonå•†å“æƒ…å ±å–å¾—æ‹¡å¼µæ©Ÿèƒ½ã®å®Œæˆå›³](../../../assets/images/post/chrome-extensions-wxt-01.jpg 'Amazonå•†å“æƒ…å ±å–å¾—æ‹¡å¼µæ©Ÿèƒ½ã®å®Œæˆå›³')

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

ä»Šå›ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```
.
â”œâ”€â”€ assets
â”‚Â Â  â”œâ”€â”€ react.svg
â”‚Â Â  â””â”€â”€ tailwind.css
â”œâ”€â”€ components
â”‚Â Â  â””â”€â”€ Scraping.tsx
â”œâ”€â”€ entrypoints
â”‚Â Â  â”œâ”€â”€ content
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ getAmazonProductData.ts
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.ts
â”‚Â Â  â””â”€â”€ popup
â”‚Â Â      â”œâ”€â”€ index.html
â”‚Â Â      â””â”€â”€ main.tsx
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ public
â”‚Â Â  â”œâ”€â”€ icon
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ 128.png
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ 16.png
â”‚Â Â  â”‚Â Â  â””â”€â”€ 48.png
â”‚Â Â  â””â”€â”€ wxt.svg
â”œâ”€â”€ tsconfig.json
â””â”€â”€ wxt.config.ts
```

WXTã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸéš›ã«ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯é‚ªé­”ãªã®ã§ã€ã„ã£ãŸã‚“`entrypoints`ä»¥ä¸‹ã¯å…¨ã¦å‰Šé™¤ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

### wxt.config.tsã®ç·¨é›†

WXTã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹`wxt.config.ts`ã‚’ç·¨é›†ã—ã¾ã—ã‚‡ã†ã€‚æ‹¡å¼µæ©Ÿèƒ½ã®åå‰ã‚„èª¬æ˜ã€é–‹ç™ºãƒ–ãƒ©ã‚¦ã‚¶ã‚’èµ·å‹•ã—ãŸæ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹URLã‚’æŒ‡å®šã—ã¾ã™ã€‚

```ts {8-10,12,14} title="wxt.config.ts"
import { defineConfig } from 'wxt';
import tailwindcss from '@tailwindcss/vite';

// See https://wxt.dev/api/config.html
export default defineConfig({
  extensionApi: 'chrome',
  modules: ['@wxt-dev/module-react'],
  runner: {
    startUrls: ['https://www.amazon.co.jp/'],
  },
  manifest: {
    name: 'Amazon å•†å“æƒ…å ±å–å¾—',
    version: '1.0',
    description: 'Amazonã®å•†å“ãƒšãƒ¼ã‚¸ã‹ã‚‰ç”»åƒURLã‚„å•†å“æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚',
    manifest_version: 3,
  },
  vite: () => ({
    plugins: [tailwindcss()],
  })
});
```

ç‰¹å®šã®ã‚µã‚¤ãƒˆãªã©ã§ã®ã¿æ©Ÿèƒ½ã•ã›ã‚‹æ‹¡å¼µæ©Ÿèƒ½ã®å ´åˆã¯ã€`runner.startUrls`ã«URLã‚’æŒ‡å®šã™ã‚‹ã¨é–‹ç™ºã™ã‚‹ã®ãŒä¾¿åˆ©ã«ãªã‚‹ã§ã—ã‚‡ã†ğŸš€

### popupã®ä½œæˆ

æœ€åˆã«`popup`ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚popupã¯æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã™ã€‚

`entrypoints`ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«`popup`ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’ä½œæˆã—ã€`index.html`ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚
index.htmlã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã™ã€‚

```html title="entrypoints/popup/index.html"
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Amazon å•†å“æƒ…å ±å–å¾—</title>
    <meta name="manifest.type" content="browser_action" />
    <link rel="stylesheet" href="../../assets/tailwind.css" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="./main.tsx"></script>
  </body>
</html>
```

ã“ã“ã§ã¯ã€Tailwind CSSã‚’ä½¿ã†ãŸã‚ã«`assets/tailwind.css`ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚ã¾ãŸã€Reactã‚’ä½¿ã†ãŸã‚ã€idãŒ`root`ã®è¦ç´ ã‚’ä½œæˆã—ã€main.tsxã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚

æ¬¡ã«`entrypoints/popup/main.tsx`ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

```ts title="entrypoints/popup/main.tsx"
import React from "react";
import ReactDOM from "react-dom/client";
import Scraping from "../../components/Scraping";

ReactDOM.createRoot(document.getElementById("root")!).render(
  <React.StrictMode>
    <Scraping />
  </React.StrictMode>
)
```

main.tsxã§ã¯ã€Scrapingã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚ã“ã®Scrapingã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä»Šå›ä½œæˆã™ã‚‹å•†å“æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

ãã‚Œã§ã¯ã€`components`ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«`Scraping.tsx`ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

```tsx title="components/Scraping.tsx"
import { useState, useEffect } from "react";

export default function Scraping() {
  const defaultTemplate = `<AmazonLink\n  imageId=\"${"${imageURL}"}\"\n  linkId=""\n  title=\"${"${title}"}\"\n  author=\"${"${author}"}\"\n/>`;

  const [template, setTemplate] = useState(defaultTemplate);
  const [filledTemplate, setFilledTemplate] = useState('');

  const handleTemplateChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
    const newTemplate = e.target.value;
    setTemplate(newTemplate);
  }

  const fetchProductData = () => {
    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
      chrome.tabs.sendMessage(tabs[0].id!, { action: 'getAmazonData' }, (response) => {
        if (!response) {
          console.error('No response received from content script');
          return;
        }
        setFilledTemplate(
          template
            .replace("${title}", response.title || '')
            .replace("${author}", response.author || '')
            .replace("${imageURL}", response.imageUrl || '')
        );
      });
    })
  };

  return (
    <div className="p-4 pt-2 w-72 bg-[#232E3E] text-white">
      <h2 className="text-base font-bold">Amazon å•†å“æƒ…å ±å–å¾—</h2>
      <textarea
        className="w-full p-2 border rounded mt-3"
        rows={6}
        value={template}
        onChange={handleTemplateChange}
      />
      <button onClick={fetchProductData} className="bg-blue-500 hover:bg-blue-700 font-bold py-2 px-4 rounded mt-1">
        å•†å“æƒ…å ±ã‚’å–å¾—
      </button>

      {filledTemplate && (
        <>
          <pre className="mt-3 p-2 border rounded overflow-auto">{filledTemplate}</pre>
        </>
      )}
    </div>
  )
}
```

ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ã€ä»¥ä¸‹ã®å‡¦ç†ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨çŠ¶æ…‹ã®ç®¡ç†

```tsx
const defaultTemplate = `<AmazonLink\n  imageId=\"${"${imageURL}"}\"\n  linkId=""\n  title=\"${"${title}"}\"\n  author=\"${"${author}"}\"\n/>`;

const [template, setTemplate] = useState(defaultTemplate);
const [filledTemplate, setFilledTemplate] = useState('');
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦ã€ã“ã®ãƒ–ãƒ­ã‚°ã®`<AmazonLink>`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®šç¾©ã—ã¦ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¤‰æ›´ã—ãŸéš›ã«ã¯ã€`setTemplate`ã§çŠ¶æ…‹ã‚’æ›´æ–°ã—ã¾ã™ã€‚`filledTemplate`ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå•†å“æƒ…å ±ã‚’å–å¾—ã—ãŸéš›ã«ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’åŸ‹ã‚è¾¼ã‚“ã ã‚‚ã®ã‚’ä¿æŒã—ã¾ã™ã€‚

#### ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å¤‰æ›´ã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```tsx
const handleTemplateChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
  const newTemplate = e.target.value;
  setTemplate(newTemplate);
};
```

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å€¤ã‚’å¤‰æ›´ã—ãŸéš›ã«ã€`setTemplate`ã§çŠ¶æ…‹ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã“ã®å€¤ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦ä½¿ã‚ã‚Œã¾ã™ã€‚

#### Amazonã®å•†å“ãƒ‡ãƒ¼ã‚¿å–å¾—

ã€Œå•†å“æƒ…å ±ã‚’å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã®å‡¦ç†ãŒä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```tsx
const fetchProductData = () => {
  chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
    chrome.tabs.sendMessage(tabs[0].id!, { action: 'getAmazonData' }, (response) => {
      if (!response) {
        console.error('No response received from content script');
        return;
      }
      setFilledTemplate(
        template
          .replace("${title}", response.title || '')
          .replace("${author}", response.author || '')
          .replace("${imageURL}", response.imageUrl || '')
      );
    });
  });
};
```

- `chrome.tabs.query()`ã§ç¾åœ¨é–‹ã„ã¦ã„ã‚‹ã‚¿ãƒ–ã‚’å–å¾—ã—ã¾ã™ã€‚
- `chrome.tabs.sendMessage()`ã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚Šã€Amazonã®å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã€‚
- `setFilledTemplate()`ã¨`replace`ã‚’ä½¿ã£ã¦å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«åŸ‹ã‚è¾¼ã‚€ã€‚

popupã§ã¯Webã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãŒã§ããªã„ãŸã‚ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ã€å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ¬¡ã¯ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

### ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯Webãƒšãƒ¼ã‚¸ã®DOMã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
ãã‚Œã§ã¯ã€`entrypoints/content`ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«`index.ts`ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

```ts title="entrypoints/content/index.ts"
import getAmazonProductData from "./getAmazonProductData";

export default defineContentScript({
  matches: ['*://www.amazon.co.jp/*', '*://www.amazon.com/*'],
  main() {
    chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
      if (message.action === 'getAmazonData') {
        sendResponse(getAmazonProductData());
      }
    })
  }
})
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`getAmazonProductData`é–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ã“ã®é–¢æ•°ã¯ã€Amazonã®å•†å“ãƒšãƒ¼ã‚¸ã‹ã‚‰å•†å“æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

`matches`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã¯ã€ã€Œ*://www.amazon.co.jp/*ã€ã¨ã€Œ*://www.amazon.com/*ã€ã®URLã«ãƒãƒƒãƒã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ‹¡å¼µæ©Ÿèƒ½ã¯Amazonã®å•†å“ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸéš›ã«ã®ã¿ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

`main`é–¢æ•°ã§ã¯ã€`chrome.runtime.onMessage.addListener`ã‚’ä½¿ã£ã¦ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã—ãŸéš›ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã§ã¯ã€`getAmazonProductData`é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã€å•†å“æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚

å…ˆã»ã©ã€popupã§ã€Œå•†å“æƒ…å ±ã‚’å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã«ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆgetAmazonDataï¼‰ã‚’é€ä¿¡ã—ã¦ã„ã¾ã—ãŸã€‚ãã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã—ãŸéš›ã«ã€`getAmazonProductData`é–¢æ•°ã‚’å®Ÿè¡Œã—ã€å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’`sendResponse`é–¢æ•°ã§è¿”ã—ã¦ã„ã¾ã™ã€‚

ãã‚Œã§ã¯ã€getAmazonProductDataé–¢æ•°ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

```ts title="entrypoints/content/getAmazonProductData.ts"
export default function getAmazonProductData() {
  const title = document.querySelector('#productTitle')?.textContent?.trim() || '';
  const author = document.querySelector('.author .a-link-normal')?.textContent?.trim() || '';
  const imageSrc = document.querySelector('#imgTagWrapperId img')?.getAttribute('src') || '';
  const imageUrl = imageSrc ? extractImageId(imageSrc) : '';

  return { title, author, imageUrl };
}

function extractImageId(url: string) {
  const match = url.match(/\/images\/I\/([^\/]+)\.jpg/);
  return match ? match[1] : null;
}
```

ã“ã®é–¢æ•°ã§ã¯ã€DOMæ“ä½œã‚ˆã‚ŠAmazonã®å•†å“ãƒšãƒ¼ã‚¸ã‹ã‚‰å•†å“æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚ç”»åƒURLã®ã¨ã“ã‚ã¯ã€ä¸€æ„ãªIDã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã€`extractImageId`é–¢æ•°ã‚’ä½œã£ã¦ä½¿ã£ã¦ã„ã¾ã™ã€‚

ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã§ããŸã®ã§ã€ã€Œå•†å“æƒ…å ±ã‚’å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å½¢ã§å•†å“æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼

###  ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚’ä½œã‚‹

å–å¾—ã§ããŸå•†å“æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼ã§ãã‚‹ã‚ˆã†ã«ã€ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚

```tsx {6-9,34-38} title="components/Scraping.tsx"
export default function Scraping() {

  // ...

  // ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
  const copyToClipboard = () => {
    navigator.clipboard.writeText(filledTemplate);
    setIsCopying(true);
  }

  return (
    <div className="p-4 pt-2 w-72 bg-[#232E3E] text-white">
      <h2 className="text-base font-bold">Amazon å•†å“æƒ…å ±å–å¾—</h2>
      <textarea
        className="w-full p-2 border rounded mt-3"
        rows={6}
        value={template}
        onChange={handleTemplateChange}
      />
      <button onClick={fetchProductData} className="bg-blue-500 hover:bg-blue-700 font-bold py-2 px-4 rounded mt-1">
        å•†å“æƒ…å ±ã‚’å–å¾—
      </button>

      {filledTemplate && (
        <>
          <pre className="mt-3 p-2 border rounded overflow-auto">{filledTemplate}</pre>
          <button onClick={copyToClipboard} className="mt-2 p-2 bg-orange-400 rounded w-full font-bold">
            ã‚³ãƒ”ãƒ¼
          </button>
        </>
      )}

      // ã‚³ãƒ”ãƒ¼ãŒå®Œäº†ã—ãŸã‚‰ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      {isCopying && (
        <div className="mt-2 text-center">
          ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼
        </div>
      )}
    </div>
  )
}
```

`navigator.clipboard.writeText`ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¦ã„ã¾ã™ã€‚
`isCopying`ã¨ã„ã†çŠ¶æ…‹ã‚’ä½œã£ã¦ã€ã‚³ãƒ”ãƒ¼ãŒå®Œäº†ã—ãŸã‚‰ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã§ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼
æœ€å¾Œã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç·¨é›†ã—ãŸã‚‰ã€ãã®æƒ…å ±ã‚’ä¿å­˜ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç·¨é›†ã—ãŸã‚‰ã€localStorageã«ä¿å­˜ã™ã‚‹

ç·¨é›†ã—ãŸæƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã«ã¯ã€localStorageã‚’ä½¿ã„ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç·¨é›†ã™ã‚‹ã¨ã€`handleTemplateChange`é–¢æ•°ãŒå‘¼ã°ã‚Œã‚‹ã®ã§ã€ãã®ä¸­ã§`localStorage.setItem`ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’localStorageã«ä¿å­˜ã—ã¾ã™ã€‚ãã®æ™‚ã®ã‚­ãƒ¼ã¯ã€ŒamazonTemplateã€ã¨ã—ã¾ã™ã€‚

ãã—ã¦ã€useEffectã‚’ä½¿ã£ã¦ã€åˆå›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«localStorageã‹ã‚‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒä¿å­˜ã•ã‚ŒãŸã¾ã¾ã«ãªã‚Šåˆ©ä¾¿æ€§ãŒä¸ŠãŒã‚‹ã§ã—ã‚‡ã†ã€‚


```tsx {4-9,15} title="components/Scraping.tsx"
export default function Scraping() {

  // åˆå›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«ã€localStorageã‹ã‚‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã‚€
  useEffect(() => {
    const savedTemplate = localStorage.getItem('amazonTemplate');
    if (savedTemplate) {
      setTemplate(savedTemplate);
    }
  }, []);

  const handleTemplateChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
    const newTemplate = e.target.value;
    setTemplate(newTemplate);
    // localStorageã«ä¿å­˜
    localStorage.setItem('amazonTemplate', newTemplate);
  }
}
```

ä»¥ä¸Šã§ã€WXTã§Amazonã®å•†å“æƒ…å ±ã‚’å–å¾—ã™ã‚‹æ‹¡å¼µæ©Ÿèƒ½ãŒå®Œæˆã—ã¾ã—ãŸï¼
ã“ã‚Œã‚’ã“ã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã‚Œã°ğŸ‘‡ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã€æ™‚é–“çŸ­ç¸®ã«ãªã‚Šã¾ã—ãŸï¼

<AmazonLink imageId="71+jz0lyKnL._SY522_" linkId="3FPBzDd" title="JavaScript ç¬¬7ç‰ˆ" author="David Flanagan"/>

## ã¾ã¨ã‚

ä»Šå›ã¯ã˜ã‚ã¦Chromeæ‹¡å¼µæ©Ÿèƒ½ã‚’ä½œã£ã¦ã¿ã¾ã—ãŸã€‚ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®WXTã‚’ä½¿ã†ã“ã¨ã§ã€ã¡ã‚‡ã£ã¨èª¿ã¹ã‚‹ã ã‘ã§ç°¡å˜ã«ä½œã‚‹ã“ã¨ãŒã§ãã¦è‰¯ã‹ã£ãŸã§ã™ï¼

ä»Šå¾Œã‚‚è‡ªåˆ†ã ã‘ãŒä½¿ã†ã‚ˆã†ãªChromeæ‹¡å¼µæ©Ÿèƒ½ã‚’ä½œã£ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

ã“ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

## å‚è€ƒ

- [WXTå…¬å¼](https://wxt.dev/)
- [ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã‚’Reactã§é–‹ç™ºã™ã‚‹ã€WXTã€‘](https://qiita.com/t-ujiie/items/8de2e101368245816e9f)
- [ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½œã‚‹ãªã‚‰WXTã‚’ä½¿ãŠã†](https://hamachi25.com/blog/post/wxt-browser-extension/)