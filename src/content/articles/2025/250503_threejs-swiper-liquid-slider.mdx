---
title: Three.jsÃ—Swiperã§Liquidã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ä½œã‚‹æ–¹æ³•
slug: threejs-swiper-liquid-slider
pubDate: '2025-05-03'
image: ../../../assets/images/threejs-swiper-liquid-slider.jpg
ogp: 'images/ogp/threejs-swiper-liquid-slider.jpg'
category: Coding
tags:
  - Three.js
  - Swiper
description: Three.jsã¨Swiperã‚’ä½¿ã£ã¦Liquidã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ä½œã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚
relatedPosts:
  - recommended-book-for-frontend-devs
  - astrojs-swiper-01
---
import DemoBtn from '../../../components/markdown/DemoBtn.astro';

<DemoBtn url="https://nono-k.github.io/liquid-slider-threejs-swiper" />

## ã¯ã˜ã‚ã«

Three.jsã¨Swierã§ã¤ãã‚‹WebGLè¡¨ç¾ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ä½œã‚Šæ–¹ã‚’è§£èª¬ã—ã¦ã„ã‚‹è¨˜äº‹ãŒãªã„ã®ã§ã€è©¦ã—ã«ä½œã£ã¦ã¿ã¾ã—ãŸï¼ä»Šå›è§£èª¬ã™ã‚‹ã®ã¯æ‰€è¬‚ã€Liquidã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¨å‘¼ã°ã‚Œã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆåŠ¹æœã‚’æŒã£ãŸã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚ãƒã‚¤ã‚ºã¯ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã§ã¯ä½œã‚‰ãªã„ã§ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ç”»åƒã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

ä¸Šã®ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ã§ä»Šå›ä½œã‚‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’è©¦ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
ğŸ‘‡ã¯ä»Šå›ã®ãƒªãƒã‚¸ãƒˆãƒªã§ã™ï¼Astroç’°å¢ƒã§ä½œã£ã¦ã¾ã™ã®ã§é©å®œç½®ãæ›ãˆã¦ã‚‚ã‚‰ãˆã‚Œã°ã¨

https://github.com/nono-k/liquid-slider-threejs-swiper

## è€ƒãˆæ–¹

ãƒ‡ãƒ¢ã®ã‚ˆã†ãªLiquidã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¯ã€CSSã®ã¿ã§ã¯å®Ÿç¾ã§ããªã„ã®ã§WebGLã€Three.jsã‚’ä½¿ã£ã¦å®Ÿç¾ã—ã¦ã„ãã¾ã™ã€‚

Liquidã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯Three.jsã§ä½œã‚‹Canvasã«æ›ã‘ã¾ã™ã€‚Swiperã§ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ç”»åƒé¡ã¯ã€ã‚¹ãƒ¯ã‚¤ãƒ—ãªã©ã®æ“ä½œã§å‹•ä½œã™ã‚‹ãŸã‚ã«å­˜åœ¨ã—ã¾ã™ã€‚ãªã®ã§ã€Swiperã§ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ç”»åƒã‚’ä¸‹ã«é…ç½®ã—ã¦opacity: 0ã«ã—è¦‹ãˆãªãã—ã€Three.jsã§ä½œã£ãŸCanvasã‚’ä¸Šã«é…ç½®ã—ã¾ã™ã€‚

!['ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼'](../../../assets/images/post/threejs-swiper-liquid-slider-01.png 'ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼')

ä¸Šè¨˜ã®å›³ã¯ã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã¾ãšã¯ã€ã“ã®ã‚ˆã†ã«HTMLã‚’æº–å‚™ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

## HTML

HTMLã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```html title="index.html"
<div class="container">
  // Swiper
  <div class="swiper">
    <div class="swiper-wrapper">
      <div class="swiper-slide">
        <img src="images/image-01.jpg" alt="">
      </div>

      // ä»¥ä¸‹ç¶šã ä»Šå›ã¯5æšã®ç”»åƒã‚’ç”¨æ„

    </div>
  </div>

  // Three.jsç”¨ã®Canvas
  <div class="liquid-canvas"></div>
</div>
```

HTMLã¯ã€Swiperã®åŸºæœ¬ã®ã‚³ãƒ¼ãƒ‰ã¨ã€Three.jsã§ä½¿ã†divã‚’é…ç½®ã—ã¦ã„ã¾ã™ã€‚
å®Ÿéš›ã®ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ç®‡æ‰€ã¯Canvasä¸Šã§è¡¨ç¤ºã™ã‚‹ã®ã§ã™ãŒã€SwiperãŒä¸Šæ‰‹ãæ©Ÿèƒ½ã™ã‚‹ã‚ˆã†ã«ç”»åƒã®æšæ•°ã‚’æƒãˆã¦ãã ã•ã„ã€‚ä»Šå›ã¯5æšã®ç”»åƒã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚

## CSS

CSSã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```css title="styles.css"
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
canvas {
  position: absolute;
  top: 0;
  left: 0;
  z-index: -1;
  width: 100%;
  height: 100%;
  pointer-events: none;
}
.container {
  position: relative;
  width: 100%;
  height: 100vh;
  overflow: hidden;
}
.swiper {
  width: 100%;
  height: 100vh;
}
.swiper-slide {
  opacity: 0;
}
```

CSSã¯ã€Three.jsã§ä½¿ã†Canvasã‚’position: absoluteã§ä¸Šã«é…ç½®ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€Swiperã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ç”»åƒã¯opacity: 0ã§è¦‹ãˆãªãã—ã¦ã„ã¾ã™ã€‚


## JavaScript

ãã‚Œã§ã¯ã€æœ€å¾Œã«Three.jsã¨Swiperã§Liquidã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ä½œã‚‹ãŸã‚ã®JavaScriptã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

ã“ã“ã§ã¯LiquidSliderã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã€ä¸‹è¨˜ã®ã‚ˆã†ãªindex.jsã§èª­ã¿å‡ºã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

```js title="index.js"
import { LiquidSlider } from './liquidSlider';

window.addEventListener('DOMContentLoaded', () => {
  const container = document.querySelector('.liquid-canvas');

  const slider = new LiquidSlider({
    container: container,
    images: [
      `/image01.jpg`,
      `/image02.jpg`,
      `/image03.jpg`,
      `/image04.jpg`,
      `/image05.jpg`,
    ],
    noiseImage: `/disp.webp`,
  });
});
```

LiquidSliderã‚¯ãƒ©ã‚¹ã®containerã«ã¯ã€Three.jsã§ä½¿ã†Canvasã‚’æŒ‡å®šã—ã¾ã™ã€‚imagesã«ã¯ã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ç”»åƒã®ãƒ‘ã‚¹ã‚’é…åˆ—ã§æ¸¡ã—ã¾ã™ã€‚noiseImageã«ã¯ã€ãƒã‚¤ã‚ºç”»åƒã®ãƒ‘ã‚¹ã‚’æ¸¡ã—ã¾ã™ã€‚

ãƒã‚¤ã‚ºç”»åƒã¯ä»Šå›ã¯[ã“ã®ã‚ˆã†ãªç”»åƒ](https://github.com/nono-k/liquid-slider-threejs-swiper/blob/main/public/disp.webp)ã‚’ä½¿ã£ã¦ã¾ã™ã€‚ãƒã‚¤ã‚ºç”»åƒã«ã‚ˆã£ã¦Liquidã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®è¡¨ç¾ãŒå¤‰ã‚ã‚‹ã®ã§ã€ã„ã‚ã„ã‚è©¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼

ãã‚Œã§ã¯ã€LiquidSliderã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### LiquidSliderã‚¯ãƒ©ã‚¹

LiquidSliderã‚¯ãƒ©ã‚¹ã§ã¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã¨ã—ã¦Three.jsã¨Swiperã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æ“ä½œã¨ã—ã¦GSAPã‚’åˆ©ç”¨ã—ã¾ã™ã€‚constructorã¾ã§ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```js title="liquidSlider.js"
import gsap from 'gsap';
import { Swiper } from 'swiper';
import { Autoplay, Navigation } from 'swiper/modules';
import * as THREE from 'three';

export class LiquidSlider {
  constructor(options) {
    this.container = options.container;     // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’æç”»ã™ã‚‹DOMè¦ç´ 
    this.images = options.images;           // åˆ‡ã‚Šæ›¿ãˆã‚‹ç”»åƒã®URLé…åˆ—
    this.noiseImage = options.noiseImage;   // ãƒã‚¤ã‚ºç”»åƒï¼ˆæ­ªã¿ã«ä½¿ç”¨ï¼‰
    this.width = window.innerWidth;
    this.height = window.innerHeight;
    this.currentIndex = 0;                  // ç¾åœ¨è¡¨ç¤ºä¸­ã®ç”»åƒã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    this.isAnimating = false;               // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°

    this.initThree();       // Three.jsã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    this.initSwiper();      // Swiper.jsã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    this.loadTextures();    // ç”»åƒã¨ãƒã‚¤ã‚ºã®ãƒ­ãƒ¼ãƒ‰
    this.render();          // æç”»ãƒ«ãƒ¼ãƒ—é–‹å§‹
    window.addEventListener('resize', this.onResize.bind(this)); // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
  }
}
```

constructorã§ã¯ã€åˆæœŸçŠ¶æ…‹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ã—ã€ä¸»è¦ãªåˆæœŸåŒ–ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ãƒªã‚µã‚¤ã‚ºå‡¦ç†ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚ç¶šã„ã¦`initThree`ã€`initSwiper`ã€`loadTextures`ãƒ¡ã‚½ãƒƒãƒ‰ãªã©ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### initThree

initThreeãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€Three.jsã®`Scene`,`Camera`,`Renderer`ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚

```js title="initThree"
initThree() {
  this.scene = new THREE.Scene(); // ã‚·ãƒ¼ãƒ³ä½œæˆ

  this.camera = new THREE.OrthographicCamera(
    this.width / -2, this.width / 2,
    this.height / 2, this.height / -2,
    0.1, 1000
  );
  // æ­£å°„å½±ã‚«ãƒ¡ãƒ©ï¼šå¹³é¢æç”»ã«æœ€é©

  this.renderer = new THREE.WebGLRenderer({ alpha: true });
  this.renderer.setSize(this.width, this.height);
  this.container.appendChild(this.renderer.domElement); // DOMã«æç”»ã‚’è¿½åŠ 
}
```

this.containerã«appendChildã™ã‚‹ã“ã¨ã§ã€CanvasãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚(ã“ã“ã§ã¯`.liquid-canvas`ã®ä¸‹ã«CanvasãŒè¿½åŠ ã•ã‚Œã‚‹)

### initSwiper

initSwiperãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€Swiperã‚’åˆæœŸåŒ–ã—ã€ã‚¹ãƒ©ã‚¤ãƒ‰ãŒå¤‰ã‚ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§Three.jså´ã®ç”»åƒã‚‚åˆ‡ã‚Šæ›¿ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```js title="initSwiper"
initSwiper() {
  this.swiper = new Swiper('.swiper', {
    modules: [Navigation, Autoplay],
    slidesPerView: 1,
    loop: true,
    speed: 2150,
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    autoplay: {
      delay: 6000,
      disableOnInteraction: false,
    },
    on: {
      // ã‚¹ãƒ©ã‚¤ãƒ‰é–‹å§‹æ™‚ã«ãƒ†ã‚¯ã‚¹ãƒãƒ£åˆ‡ã‚Šæ›¿ãˆç”¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’å®Ÿè¡Œ
      slideChangeTransitionStart: slider => {
        const newIndex = slider.realIndex;
        const total = this.textures.length;

        // ã‚¹ãƒ©ã‚¤ãƒ‰ã®æ–¹å‘åˆ¤å®š
        const diff = newIndex - this.currentIndex;
        const forward = (diff > 0 && diff < total / 2) || diff < -total / 2;

        // uEffect ã®å€¤ã§ãƒã‚¤ã‚ºæ­ªã¿æ–¹å‘ã‚’åˆ¶å¾¡
        this.uniforms.uEffect.value = forward ? -0.1 : 0.1;

        this.nextSlide(newIndex);
      },
    },
  });
}
```

Swiperã®è¨­å®šã§ã¯ã€`slidesPerView`ã‚’1ã«è¨­å®šã—ã€1æšã®ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚`autoplay`ã‚‚è¨­å®šã™ã‚‹ã“ã¨ã§ã€è‡ªå‹•ã§ã‚¹ãƒ©ã‚¤ãƒ‰ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

`slideChangeTransitionStart`ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€ã‚¹ãƒ©ã‚¤ãƒ‰ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã§ã™ã€‚ã“ã“ã§ã¯ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼å´ã§åˆ©ç”¨ã™ã‚‹`uEffect`ã®å€¤ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã„ã¾ã™ã€‚ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®Nextãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã„ã‚‹ã‹Prevãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‹ã‚’åˆ¤å®šã—ã€`uEffect`ã«æ­£è² ã®å€¤ã‚’æ¸¡ã™ã“ã¨ã§ã€ãƒã‚¤ã‚ºã«ã‚ˆã‚‹æ­ªã¿æ–¹å‘ã‚’åˆ¶å¾¡ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€`swiper.realIndex`ã§æ¬¡ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—ã—ã€`nextSlide`ãƒ¡ã‚½ãƒƒãƒ‰ã«æ¸¡ã—ã¦ç”»åƒã‚’åˆ‡æ›¿ãˆã¾ã™ã€‚ã“ã¡ã‚‰ã¯å¾Œã§è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### loadTextures

loadTexturesãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€`THREE.TextureLoader`ã§ç”»åƒã¨ãƒã‚¤ã‚ºç”»åƒã‚’éåŒæœŸã«ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

```js title="loadTextures"
loadTextures() {
  const loader = new THREE.TextureLoader();
  const imagePromises = this.images.map(src => loader.loadAsync(src));
  const noisePromise = loader.loadAsync(this.noiseImage);

  Promise.all([...imagePromises, noisePromise]).then(results => {
    this.textures = results.slice(0, -1);           // é€šå¸¸ç”»åƒ
    this.noiseTexture = results[results.length - 1]; // ãƒã‚¤ã‚ºç”»åƒ
    this.createMesh();                               // ãƒ¡ãƒƒã‚·ãƒ¥ä½œæˆ
  });
}
```

`this.textures`ã«ã¯ã€sliceé–¢æ•°ã‚’ä½¿ã£ã¦ã‚¹ãƒ©ã‚¤ãƒ‰ã«è¡¨ç¤ºã™ã‚‹ç”»åƒã‚’é…åˆ—ã§æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚`this.noiseTexture`ã«ã¯ã€ãƒã‚¤ã‚ºç”»åƒã‚’æ ¼ç´ã—ã¾ã™ã€‚

éåŒæœŸã«ç”»åƒã®ãƒ­ãƒ¼ãƒ‰ãŒçµ‚ã‚ã£ãŸã‚‰ã€`createMesh`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ã€ãƒ¡ãƒƒã‚·ãƒ¥ã‚’ä½œæˆã—ã¾ã™ã€‚

### createMesh

createMeshãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€Three.jsã®ãƒ¡ãƒƒã‚·ãƒ¥ã‚’ä½œæˆã—ã¾ã™ã€‚

```js title="createMesh"
createMesh() {
  // è¡¨ç¤ºä¸­ã¨æ¬¡ã®ç”»åƒãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’å–å¾—
  const texture1 = this.textures[this.currentIndex];
  const texture2 =
    this.textures[(this.currentIndex + 1) % this.textures.length];

  const { planeWidth, planeHeight } = this.getCoverSize(texture1);
}
```

`texture1`ã«ã¯ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã®ç”»åƒã‚’ã€`texture2`ã«ã¯æ¬¡ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã®ç”»åƒã‚’æ ¼ç´ã—ã¾ã™ã€‚`planeWidth`ã¨`planeHeight`ã¯ã€`getCoverSize`ãƒ¡ã‚½ãƒƒãƒ‰ã§ç¾åœ¨ã®ç”»åƒã®ã‚µã‚¤ã‚ºã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚`getCoverSize`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

#### getCoverSize

```js title="getCoverSize"
getCoverSize(texture) {
  // ãƒ†ã‚¯ã‚¹ãƒãƒ£ãŒç”»é¢ã‚’è¦†ã†ã‚ˆã†ã«ã‚µã‚¤ã‚ºã‚’è¨ˆç®—ï¼ˆcover ç›¸å½“ï¼‰
  const imageAspect = texture.image.width / texture.image.height;
  const screenAspect = this.width / this.height;

  let planeWidth = this.width;
  let planeHeight = this.height;

  if (screenAspect > imageAspect) {
    // æ¨ªå¹…å„ªå…ˆã§æ‹¡å¤§
    planeWidth = this.width;
    planeHeight = this.width / imageAspect;
  } else {
    // é«˜ã•å„ªå…ˆã§æ‹¡å¤§
    planeHeight = this.height;
    planeWidth = this.height * imageAspect;
  }

  return { planeWidth, planeHeight };
}
```

`getCoverSize`ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€ç”»é¢ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã¨ç”»åƒã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’æ¯”è¼ƒã—ã¦ã€ã©ã¡ã‚‰ã®è¾ºã‚’å„ªå…ˆã—ã¦æ‹¡å¤§ã™ã‚‹ã‹ã‚’æ±ºå®šã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç”»åƒãŒç”»é¢ã«ã´ã£ãŸã‚Šåã¾ã‚‹ã‚ˆã†ã«ã‚µã‚¤ã‚ºã‚’è¨ˆç®—ã™ã‚‹ã“ã¨ãŒã§ãè¡¨ç¤ºã™ã‚‹ç”»åƒã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ç¶­æŒã—ãŸã¾ã¾ç”»é¢ã«è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚


ç¶šã„ã¦ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã§ä½¿ã†ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ å¤‰æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚

```js title="createMesh"
createMesh() {
  // ...

  // ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«æ¸¡ã™ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ å¤‰æ•°ã‚’å®šç¾©
  this.uniforms = {
    uProgress: { value: 0 },
    uEffect: { value: -0.1 },
    uTexture1: { value: texture1 },
    uTexture2: { value: texture2 },
    uNoiseTexture: { value: this.noiseTexture },
    uResolution: { value: new THREE.Vector2(this.width, this.height) },
  };
}
```
ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ å¤‰æ•°ã®å½¹å‰²ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚

- `uProgress`: ã‚¹ãƒ©ã‚¤ãƒ‰ã®é€²è¡Œåº¦ã‚’è¡¨ã™å€¤(0~1)
- `uEffect`: æ­ªã¿ã®å¼·åº¦ã¨æ–¹å‘ã‚’åˆ¶å¾¡ã™ã‚‹å€¤
- `uTexture1`ã€`uTexture2`: ç¾åœ¨ã¨æ¬¡ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã®ç”»åƒ
- `uNoiseTexture`: ãƒã‚¤ã‚ºç”»åƒ
- `uResolution`: æç”»é ˜åŸŸã®ã‚µã‚¤ã‚º

ç¶šã„ã¦ã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

```js title="createMesh"
createMesh() {
  // ...

  // é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ï¼ˆUVåº§æ¨™ã®ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼ï¼‰
  const vertexShader = `
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `;

  // ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ï¼ˆãƒã‚¤ã‚ºã«åŸºã¥ãæ­ªã¿ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä»˜ãã®ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰ï¼‰
  const fragmentShader = `
    uniform sampler2D uTexture1;
    uniform sampler2D uTexture2;
    uniform sampler2D uNoiseTexture;
    uniform float uProgress;
    uniform float uEffect;
    varying vec2 vUv;

    void main() {
      vec2 uv = vUv;
      vec4 noise = texture2D(uNoiseTexture, uv);

      vec2 distortedPosition = vec2(
        uv.x + uProgress * (noise.r * uEffect),
        uv.y + uProgress * (noise.g * uEffect)
      );

      vec2 distortedPosition2 = vec2(
        uv.x - (1.0 - uProgress) * (noise.r * uEffect),
        uv.y - (1.0 - uProgress) * (noise.g * uEffect)
      );

      vec4 texture1 = texture2D(uTexture1, distortedPosition);
      vec4 texture2 = texture2D(uTexture2, distortedPosition2);

      gl_FragColor = mix(texture1, texture2, vec4(uProgress));
    }
  `;
}
```

ã“ã“ã§ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«ã¤ã„ã¦è©³ã—ãè¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

#### fragmentShader

ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã§ã¯2æšã®ç”»åƒãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ã€ãƒã‚¤ã‚ºã‚’ä½¿ã£ã¦ã‚†ãŒã¾ã›ãŸUVåº§æ¨™ã§æç”»ã—ã€ãã‚Œã‚‰ã‚’æ··ãœåˆã‚ã›ã‚‹ã“ã¨ã§ã€æµä½“ã®ã‚ˆã†ãªæ»‘ã‚‰ã‹ãªé·ç§»ã‚’ä½œã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®å‡¦ç†æ§‹é€ ã¯ã€ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚

```glsl
uniform sampler2D uTexture1;      // ç¾åœ¨ã®ç”»åƒ
uniform sampler2D uTexture2;      // æ¬¡ã®ç”»åƒ
uniform sampler2D uNoiseTexture;  // æ­ªã¿ã«ä½¿ã†ãƒã‚¤ã‚ºç”»åƒ
uniform float uProgress;          // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®é€²è¡Œåº¦ï¼ˆ0 â†’ 1ï¼‰
uniform float uEffect;            // æ­ªã¿æ–¹å‘ãƒ»å¼·ã•
varying vec2 vUv;                 // ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®UVåº§æ¨™
```

`noise`å¤‰æ•°ã¯ã€ãƒã‚¤ã‚ºç”»åƒã‹ã‚‰ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã—ã¦å–å¾—ã—ã¾ã™ã€‚

```glsl
// ãƒã‚¤ã‚ºç”»åƒã‹ã‚‰ã“ã®ãƒ”ã‚¯ã‚»ãƒ«ä½ç½®ã®è‰²ï¼ˆr, g, bï¼‰ã‚’å–å¾—
// r â†’ xæ–¹å‘ã®æ­ªã¿ã«ä½¿ã†ã€g â†’ yæ–¹å‘ã®æ­ªã¿ã«ä½¿ã†
vec4 noise = texture2D(uNoiseTexture, uv);
```

`distortedPosition`ã¨`distortedPosition2`ã¯ã€ãã‚Œãã‚Œç¾åœ¨ã®ç”»åƒã¨æ¬¡ã®ç”»åƒã®æ­ªã¿ã‚’è¨ˆç®—ã—ãŸUVåº§æ¨™ã§ã™ã€‚

```glsl
// ä»Šã®ç”»åƒã®UVã‚’æ­ªã¾ã›ã‚‹
vec2 distortedPosition = vec2(
  uv.x + uProgress * (noise.r * uEffect),
  uv.y + uProgress * (noise.g * uEffect)
);

// æ¬¡ã®ç”»åƒã®UVã‚‚é€†æ–¹å‘ã«æ­ªã¾ã›ã‚‹
vec2 distortedPosition2 = vec2(
  uv.x - (1.0 - uProgress) * (noise.r * uEffect),
  uv.y - (1.0 - uProgress) * (noise.g * uEffect)
);
```

- `uProgress`: 0â†’1ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã‚‹
- `uEffect`: +0.1ã¾ãŸã¯-0.1ã§æ–¹å‘ã‚’åˆ‡ã‚Šæ›¿ãˆ

çµæœçš„ã«ã€**æ­ªãªãŒã‚‰2ã¤ã®ç”»åƒãŒæ··ã–ã‚Šåˆã†ã“ã¨ã§ã€æµä½“ã®ã‚ˆã†ãªæ»‘ã‚‰ã‹ãªé·ç§»ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚**

`texture1`ã¨`texture2`ã¯ã€ãã‚Œãã‚Œ`distortedPosition`ã¨`distortedPosition2`ã‚’ä½¿ã£ã¦ç”»åƒã‚’å–å¾—ã—ã¾ã™ã€‚

```glsl
vec4 texture1 = texture2D(uTexture1, distortedPosition);
vec4 texture2 = texture2D(uTexture2, distortedPosition2);
```

å„ç”»åƒã‚’ã€Œæ­ªã¾ã›ãŸUVåº§æ¨™ã€ã§ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã—ã¦ã„ã‚‹ã®ã§ã€ç”»åƒãŒæ­ªã‚“ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
æœ€å¾Œã«ã€`gl_FragColor`ã«2ã¤ã®ç”»åƒã‚’`mix`é–¢æ•°ã§æ··ãœåˆã‚ã›ã¾ã™ã€‚

```glsl
gl_FragColor = mix(texture1, texture2, vec4(uProgress));
```

- `uProgress`ãŒ0ã®æ™‚ï¼š`texture1`ã®ã¿è¡¨ç¤º
- `uProgress`ãŒ1ã®æ™‚ï¼š`texture2`ã®ã¿è¡¨ç¤º
- ä¸­é–“ï¼šæ­ªã¾ã›ãªãŒã‚‰2ã¤ã®ç”»åƒã‚’æ··ãœåˆã‚ã›ã¦è¡¨ç¤º

ã“ã®ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«ã‚ˆã£ã¦ã€LiquidåŠ¹æœã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸğŸ¥ƒ

---

ãã‚Œã§ã¯ã€createMeshãƒ¡ã‚½ãƒƒãƒ‰ã®æœ€å¾Œã«Three.jsã®ãƒ¡ãƒƒã‚·ãƒ¥ã‚’ä½œæˆã—ã¾ã™ã€‚

```js title="createMesh"
createMesh() {
  // ...

  // å¹³é¢ã‚¸ã‚ªãƒ¡ãƒˆãƒªã¨ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒãƒ†ãƒªã‚¢ãƒ«ã‚’ä½œæˆ
  const geometry = new THREE.PlaneGeometry(planeWidth, planeHeight, 1, 1);
  const material = new THREE.ShaderMaterial({
    uniforms: this.uniforms,
    vertexShader,
    fragmentShader,
    transparent: true,
  });

  // ãƒ¡ãƒƒã‚·ãƒ¥ã‚’ä½œæˆã—ã¦ã‚·ãƒ¼ãƒ³ã«è¿½åŠ 
  this.mesh = new THREE.Mesh(geometry, material);
  this.scene.add(this.mesh);
}
```

ã“ã‚Œã§ã€ãƒ¡ãƒƒã‚·ãƒ¥ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚
ç¶šã„ã¦ã€ç”»åƒã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®åˆ‡æ›¿ã‚’è¡Œã†`nextSlide`ãƒ¡ã‚½ãƒƒãƒ‰ãªã©ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### nextSlide

`nextSlide`ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€æ¬¡ã®ç”»åƒã¸ã®ã‚¹ãƒ©ã‚¤ãƒ‰é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€GSAPã‚’ä½¿ã£ã¦`uProgress`ã‚’0ã‹ã‚‰1ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã¦ã„ã¾ã™ã€‚å®Œäº†ã—ãŸã‚‰`uTexture1`ã¨`uTexture2`ã‚’æ–°ã—ã„ç”»åƒã«æ›´æ–°ã—ã¾ã™ã€‚

```js title="nextSlide"
nextSlide(nextIndex) {
  // ã™ã§ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ãªã‚‰ç„¡è¦–
  if (this.isAnimating) return;

  this.isAnimating = true;
  const nextTexture = this.textures[index];
  this.uniforms.uTexture2.value = nextTexture;

  // GSAP ã§ uProgress ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã¦æ»‘ã‚‰ã‹ã«é·ç§»
  gsap.to(this.uniforms.uProgress, {
    value: 1,
    duration: 2.15,
    ease: 'power3.out',
    onComplete: () => {
      // æ¬¡ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆå®Œäº†å¾Œã®å‡¦ç†
      this.currentIndex = index;
      this.uniforms.uTexture1.value = nextTexture;
      this.uniforms.uProgress.value = 0;

      // ã•ã‚‰ã«æ¬¡ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’äºˆã‚ã‚»ãƒƒãƒˆ
      const nextIndex = (this.currentIndex + 1) % this.textures.length;
      this.uniforms.uTexture2.value = this.textures[nextIndex];

      // è¡¨ç¤ºã‚µã‚¤ã‚ºã‚’æ›´æ–°
      this.updateMeshSize();
      this.isAnimating = false;
    },
  });
}
```

ã“ã“ã§ã€GSAPã®`duration`ã¯Swiperã®`speed`ã¨åŒã˜å€¤ã«ã—ã¾ã—ã‚‡ã†ã€‚
ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†å¾Œã«å‘¼ã³å‡ºã™`updateMeshSize`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

#### updateMeshSize

```js title="updateMeshSize"
updateMeshSize() {
  // ãƒ¡ãƒƒã‚·ãƒ¥ã®ã‚µã‚¤ã‚ºã‚’å†è¨ˆç®—ã—ã¦æ›´æ–°
  if (!this.mesh) return;

  const texture = this.textures[this.currentIndex];
  const { planeWidth, planeHeight } = this.getCoverSize(texture);

  this.mesh.geometry.dispose(); // å¤ã„ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’ç ´æ£„
  this.mesh.geometry = new THREE.PlaneGeometry(planeWidth, planeHeight, 1, 1);
}
```

ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å½¹å‰²ã¯ã€ç”»åƒã®åˆ‡ã‚Šæ›¿ãˆå¾Œã«ã€è¡¨ç¤ºä¸­ç”»åƒã®ã‚µã‚¤ã‚ºã‚’å†è¨ˆç®—ã—ã€ãƒ¡ãƒƒã‚·ãƒ¥ã®ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’æ›´æ–°ã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç”»åƒã®ã‚µã‚¤ã‚ºãŒå¤‰ã‚ã£ãŸéš›ã«ã‚‚ã€ãƒ¡ãƒƒã‚·ãƒ¥ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ç¶šã„ã¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®å‡¦ç†ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### onResize

ç”»é¢ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã«ã€ã‚«ãƒ¡ãƒ©ãƒ»ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ»è§£åƒåº¦ãƒ»ãƒ¡ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºã‚’ã™ã¹ã¦æ›´æ–°ã—ã¾ã™ã€‚

```js title="onResize"
onResize() {
  // ç”»é¢ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã®å‡¦ç†
  this.width = window.innerWidth;
  this.height = window.innerHeight;
  this.camera.left = -this.width / 2;
  this.camera.right = this.width / 2;
  this.camera.top = this.height / 2;
  this.camera.bottom = -this.height / 2;
  this.camera.updateProjectionMatrix();
  this.renderer.setSize(this.width, this.height);

  if (this.uniforms.uResolution) {
    this.uniforms.uResolution.value.set(this.width, this.height);
  }

  this.updateMeshSize();
}
```

æœ€å¾Œã«renderãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### render

renderãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€Three.jsã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```js title="render"
render() {
  // æ¯ãƒ•ãƒ¬ãƒ¼ãƒ  Three.js ã®æç”»ã‚’æ›´æ–°
  this.renderer.render(this.scene, this.camera);
  requestAnimationFrame(this.render.bind(this));
}
```

`requestAnimationFrame`ã‚’ä½¿ã£ã¦æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚
ã“ã‚Œã§ã€Three.jsã¨Swiper.jsã‚’çµ„ã¿åˆã‚ã›ãŸç”»åƒã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

---

## ã¾ã¨ã‚

ã“ã®è¨˜äº‹ã§ã¯ã€Three.jsã¨Swiper.jsã‚’çµ„ã¿åˆã‚ã›ãŸLiquidåŠ¹æœã‚’æŒã¤ç”»åƒã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å®Ÿè£…æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã—ãŸã€‚Three.jsã¨Swiperã‚’çµ„ã¿åˆã‚ã›ã‚‹æ–¹æ³•ã‚’ç¢ºã‹ã‚ã‚‰ã‚ŒãŸã®ã§è‰¯ã‹ã£ãŸã§ã™ã€‚

ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å®Ÿè£…ã‚’Swiperãªã©ã®ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã«ä»»ã›ã‚‹ã“ã¨ã§ã€WebGLã‚„Three.jsã®è¡¨ç¾ã«å°‚å¿µã§ãã‚‹ã®ã§è‰¯ã„ã§ã™ã­ï¼

ã“ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

## å‚è€ƒ

- [Threejs with swiper](https://codepen.io/esdesignstudio/pen/mdGREML)(CodePen)