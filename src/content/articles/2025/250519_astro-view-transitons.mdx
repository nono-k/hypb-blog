---
title: Astroã®View Transitionsã‚’è©¦ã—ã¦ã¿ã‚‹(Three.jsã‚’ä½¿ã£ãŸä¾‹ã‚‚ã‚ã‚‹ã‚ˆ)
slug: astro-view-transitons
pubDate: '2025-05-19'
image: ../../../assets/images/astro-view-transitons.jpg
ogp: 'images/ogp/astro-view-transitons.jpg'
category: Coding
tags:
  - Astro
  - Three.js
description: Astroã®View Transitionsã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚è‡ªç”±ã«è¦ç´ ã‚’å‡ºã—å…¥ã‚Œã™ã‚‹æ–¹æ³•ã‚„Three.jsã‚’ä½¿ã£ãŸã‚¹ãƒ ãƒ¼ã‚ºãªãƒšãƒ¼ã‚¸é·ç§»ã®æ–¹æ³•ã‚‚è§£èª¬ã—ã¦ã¾ã™ã€‚
relatedPosts:
  - threejs-swiper-liquid-slider
  - recommended-book-for-frontend-devs
---
import DemoBtn from '../../../components/markdown/DemoBtn.astro';
import PostAdUnit from '../../../components/markdown/PostAdUnit.astro';

<DemoBtn url="https://nono-k.github.io/astro-view-transitions-demo/" />

## ã¯ã˜ã‚ã«

Astronã®View Transitionsã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚View Transitionsã‚’ç”¨ã„ã¦ãƒšãƒ¼ã‚¸é·ç§»ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’è‡ªç”±ã«å‡ºã—å…¥ã‚Œã™ã‚‹æ–¹æ³•ã‚„ã€ç”»åƒã®é·ç§»ã€Three.jsã§ä½œã£ãŸç‰©ä½“ã®ã‚¹ãƒ ãƒ¼ã‚ºãªç§»å‹•æ–¹æ³•ãªã©ã®ã‚„ã‚Šæ–¹ã‚’è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

å®Ÿéš›ã®å‹•ä½œã¯ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ã‚’ã”è¦§ãã ã•ã„ã€‚
(ã‚¹ãƒãƒ›ã¯è€ƒæ…®ã—ã¦ãªã„ã®ã§PCã§è¦‹ã¦ãã ã•ã„)

ğŸ‘‡ã¯ä»Šå›ã®ãƒªãƒã‚¸ãƒˆãƒªã«ãªã‚Šã¾ã™ï¼

https://github.com/nono-k/astro-view-transitions-demo

## Astroã§View Transitonsã‚’æœ‰åŠ¹ã«ã™ã‚‹

[å…¬å¼ãƒšãƒ¼ã‚¸](https://docs.astro.build/en/guides/view-transitions/)ã‚’å‚è€ƒã«Astroã§View Transitions ã‚’æœ‰åŠ¹ã«ã—ã¾ã—ã‚‡ã†ï¼
Astroã§ã¯`<ClientRouter />`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒšãƒ¼ã‚¸ã«è¿½åŠ ã™ã‚‹ã ã‘ã§View Transitionsã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹ã¨ã€ã‚µã‚¤ãƒˆå…¨ä½“ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŒ–ã•ã‚ŒãŸãƒšãƒ¼ã‚¸é·ç§»ãŒå¯èƒ½ã«ãªã‚Šã¾ã™(SPAãƒ¢ãƒ¼ãƒ‰)ã€‚

ãã‚Œã§ã¯ã€ãƒšãƒ¼ã‚¸å…¨ä½“ã§åˆ©ç”¨ã™ã‚‹ã®ã§`Layout.astro`ã®`<head>`ã®ä¸­ã«è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```astro {4,16} title="Layout.astro"
---
import '@/styles/styles.scss';

import { ClientRouter } from 'astro:transitions';
import Footer from '@/components/base/Footer.astro';
import Header from '@/components/base/Header.astro';
import Meta from '@/components/base/Meta.astro';

const props = Astro.props;
---

<!doctype html>
<html lang="ja">
  <head>
    <Meta {...props} />
    <ClientRouter fallback='swap' />
  </head>
  <body>
    <div class="container">
      <Header />
      <slot />
      <Footer />
    </div>
  </body>
</html>
```

ã“ã“ã§`fallback='swap'`ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒView Transitions APIã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„å ´åˆã«ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã—ãªã„è¨­å®šã«ãªã‚Šã¾ã™ã€‚ä»£ã‚ã‚Šã«ã€å¤ã„ãƒšãƒ¼ã‚¸ã¯ã™ãã«æ–°ã—ã„ãƒšãƒ¼ã‚¸ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ã€‚

`<ClientRouter />`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ã€ãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯`fade`ã«ãªã‚ŠopacityãŒå¤‰åŒ–ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã«ãªã‚Šã¾ã™ã€‚

## ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

`transition:name`ã¨CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ç‹¬è‡ªã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ã§ã¯Topãƒšãƒ¼ã‚¸ã¨Memberãƒšãƒ¼ã‚¸ã§ã¯ã‚¿ã‚¤ãƒˆãƒ«ã¯å·¦ã‹ã‚‰ã€ãƒ†ã‚­ã‚¹ãƒˆã¯ä¸‹ã‹ã‚‰å‡ºç¾ã—ã€Aboutãƒšãƒ¼ã‚¸ã§ã¯ã‚¿ã‚¤ãƒˆãƒ«ã¯å³ã‹ã‚‰ã€ãƒ†ã‚­ã‚¹ãƒˆã¯ä¸Šã‹ã‚‰å‡ºç¾ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

![ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³](https://res.cloudinary.com/dy8ftemi0/video/upload/v1747499341/astro-view-transitons-video-01_vyadm9.mov 'ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³')

ã“ã“ã§ã¯ã€Topãƒšãƒ¼ã‚¸ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¾‹ã«è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

### Topãƒšãƒ¼ã‚¸ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

ãã‚Œã§ã¯ã€Topãƒšãƒ¼ã‚¸ã®`index.astro`ã«`transition:name`ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¨®é¡ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```astro title="index.astro"
---
import Layout from '@/layouts/Layout.astro';
---

<Layout>
  <h1 class="title" transition:name="slide-left">Top Page</h1>
  <p class="desc" transition:name="fade-up">Lorem ipsum dolor sit amet consectetur adipisicing elit. Iusto alias facilis assumenda laudantium consequuntur esse itaque aut dolor est quaerat? Similique labore natus neque libero vero consectetur magni ipsum fuga.</p>
</Layout>
```

ã‚¿ã‚¤ãƒˆãƒ«ã«ã¯`slide-left`ã‚’ã€ãƒ†ã‚­ã‚¹ãƒˆã«ã¯`fade-up`ã¨ç‹¬è‡ªã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åã‚’ä»˜ä¸ã—ã¾ã—ãŸã€‚

ã“ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åã‚’å…ƒã«CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚
scssã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€`animation.scss`ã¨ã„ã†scssãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

```scss title="animation.scss"
@keyframes fade-in {
  from {
    opacity: 0;
  }
}

@keyframes fade-out {
  to {
    opacity: 0;
  }
}

@keyframes slide-to-left {
  to {
    transform: translateX(-40px);
  }
}

@keyframes slide-from-left {
  from {
    transform: translateX(-40px);
  }
}

@keyframes slide-to-bottom {
  to {
    transform: translateY(40px);
  }
}

@keyframes slide-from-bottom {
  from {
    transform: translateY(40px);
  }
}

::view-transition-old(slide-left) {
  animation:
    0.09s cubic-bezier(0.4, 0, 1, 1) both fade-out,
    0.3s cubic-bezier(0.4, 0, 0.2, 1) both slide-to-left;
}

::view-transition-new(slide-left) {
  animation:
    0.21s cubic-bezier(0, 0, 0.2, 1) 90ms both fade-in,
    0.3s cubic-bezier(0.4, 0, 0.2, 1) both slide-from-left;
}

::view-transition-old(fade-up) {
  animation:
    0.09s cubic-bezier(0.4, 0, 1, 1) both fade-out,
    0.3s cubic-bezier(0.4, 0, 0.2, 1) both slide-to-bottom;
}

::view-transition-new(fade-up) {
  animation:
    0.21s cubic-bezier(0, 0, 0.2, 1) 90ms both fade-in,
    0.3s cubic-bezier(0.4, 0, 0.2, 1) both slide-from-bottom;
}
```

`::view-transition-old`ã¯å‰ã®ãƒšãƒ¼ã‚¸ã®çŠ¶æ…‹ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ï¼‰ã§`::view-transition-new`ã¯æ¬¡ã®ãƒšãƒ¼ã‚¸ã®çŠ¶æ…‹ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ï¼‰ã‚’è¡¨ã—ã¾ã™ã€‚

ä¸Šè¨˜ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹ã“ã¨ã§ã€Topãƒšãƒ¼ã‚¸ã«é£›ã‚“ã éš›(å¤ã„è¡¨ç¤º)ã¯å·¦ã‹ã‚‰å‡ºç¾ã—ã€åˆ¥ãƒšãƒ¼ã‚¸ã«é£›ã¶éš›(æ–°ã—ã„è¡¨ç¤º)ã¯å·¦ã«æ¶ˆãˆã¦ã„ãã¾ã™ã€‚

ä»Šå›ã®ãƒ‡ãƒ¢ã®å…¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®šã¯[ã“ã“](https://github.com/nono-k/astro-view-transitions-demo/blob/main/src/styles/utility/animation.scss)ã«ã‚ã‚‹ã®ã§ã€ãœã²è©¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼

<PostAdUnit />

## ã‚¹ãƒ ãƒ¼ã‚ºãªç”»åƒã®ç§»å‹•

ç¶šã„ã¦ã¯ã€ç”»åƒãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã«ã‚¹ãƒ ãƒ¼ã‚ºã«ç”»åƒãŒç§»å‹•ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ã®[memberãƒšãƒ¼ã‚¸](https://nono-k.github.io/astro-view-transitions-demo/member)ã§ç¢ºèªãã ã•ã„ã€‚

![ã‚¹ãƒ ãƒ¼ã‚ºãªç”»åƒã®ç§»å‹•](https://res.cloudinary.com/dy8ftemi0/video/upload/v1747555138/astro-view-transitons-video-02_ihatyr.mp4 'ã‚¹ãƒ ãƒ¼ã‚ºãªç”»åƒã®ç§»å‹•')


åŒæ§˜ã«ã‚¹ãƒ ãƒ¼ã‚ºãªç”»åƒã®ç§»å‹•ã«ã¯ã€`transition:name`ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ä»Šå›ã®ä¾‹ã§ã¯imgã‚¿ã‚°ã«ãƒ©ãƒƒãƒ—ã™ã‚‹divã‚¿ã‚°ã«transition:nameã«ä»˜ä¸ã—ã¦ã„ã¾ã™ã€‚

```astro title="/member/index.astro"
<div class="grid" id="tabContent">
  {memberData.map(member => (
    <a href=`member/${member.id}` class="member__card" id={member.id}>
      <div
        class="member__img"
        transition:name=`member-${member.id}`
      >
        <Image
          src={member.image}
          alt={member.name}
          width={200}
          height={200}
        />
      </div>
    </a>
  ))}
</div>
```

transition:nameã«ä»˜ä¸ã™ã‚‹åå‰ã¯`member-${member.id}`ã¨ã—ã¦ä¸€æ„ãªåå‰ã«ãªã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚
ãƒªãƒ³ã‚¯å…ˆã®`/member/[id].astro`ã§ã‚‚åŒæ§˜ã«transition:nameã‚’è¨­å®šã—ã¾ã™ã€‚

```astro title="/member/[id].astro"
<div class="member">
  <div class="member__img" transition:name=`member-${id}`>
    <Image
      src={member.image}
      alt={member.name}
      width={200}
      height={200}
    />
  </div>
  <p class="member__job">Job: {member.job}</p>
  <p class="member__desc">{member.desc}</p>
</div>
```

ã“ã‚Œã§ã€ç”»åƒãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã«ã‚¹ãƒ ãƒ¼ã‚ºã«ç”»åƒãŒç§»å‹•ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
å…¨ã‚³ãƒ¼ãƒ‰ã¯memberãƒšãƒ¼ã‚¸ã¯[ã“ã¡ã‚‰](https://github.com/nono-k/astro-view-transitions-demo/blob/main/src/pages/member/index.astro)ã«ã€ãƒªãƒ³ã‚¯å…ˆã¯[ã“ã¡ã‚‰](https://github.com/nono-k/astro-view-transitions-demo/blob/main/src/pages/member/%5Bid%5D.astro)ã«ã‚ã‚‹ã®ã§ã€ç¢ºèªã—ã¦ã¿ã¦ãã ã•ã„ï¼

<PostAdUnit />

## Three.jsã§ä½œã£ãŸç‰©ä½“ã®ã‚¹ãƒ ãƒ¼ã‚ºãªç§»å‹•

æœ€å¾Œã«Three.jsã§ä½œã£ãŸç‰©ä½“ã‚’ã€ãƒšãƒ¼ã‚¸é·ç§»ã§ã‚‚ç¶­æŒã—ãªãŒã‚‰ã‚¹ãƒ ãƒ¼ã‚ºãªç§»å‹•ãŒã§ãã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

![Three.jsã‚‚ã¡ã‚ƒã‚“ã¨å‹•ã](https://res.cloudinary.com/dy8ftemi0/video/upload/v1747580729/astro-view-transitons-video-03_vczb2t.mp4 'Three.jsã‚‚ã¡ã‚ƒã‚“ã¨å‹•ã')

ä»Šå›ã®ãƒ‡ãƒ¢ã®Three.jsã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãªã©ã¯Codropsã®[ã“ã®è¨˜äº‹](https://tympanus.net/codrops/2021/01/26/twisted-colorful-spheres-with-three-js/)ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚Three.jséƒ¨åˆ†ã®ã‚³ãƒ¼ãƒ‰ã¯è©³ã—ãè§£èª¬ã—ãªã„ã®ã§æ°—ã«ãªã‚‹æ–¹ã¯ãƒ‡ãƒ¢ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’å‚ç…§ãã ã•ã„ã€‚

ã¾ãšã¯ã€Three.jsã‚’ä½¿ã†ãŸã‚`Layout.astro`ã«canvasã‚¿ã‚°ã¨scriptã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```astro title="Layout.astro"
<body>
  <div class="container">
    <Header />
    <slot />
    <Footer />
  </div>
  <canvas class="webgl" transition:persist transition:name="webgl"></canvas>
</body>

<style lang="scss">
  ::view-transition-old(webgl),
  ::view-transition-new(webgl) {
    animation: none;
  }
</style>

<script src="../scripts/index.js"></script>
```
`transition:persist`ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒšãƒ¼ã‚¸é–“ã®ç§»å‹•ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨HTMLè¦ç´ ã‚’ä¿æŒã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€`transition:name`ã‚’ä»˜ä¸ã—ã¦animation: noneã™ã‚‹ã“ã¨ã§ã€canvasã«é–¢ã—ã¦ã¯view transitionã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒç™ºç”Ÿã—ãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚ï¼ˆè‡ªåˆ†ã¯ã“ã‚Œã«æ°—ã¥ã‹ãšæ™‚é–“ã‚’ç„¡é§„ã«ã—ã¾ã—ãŸ...ï¼‰

æ¬¡ã«`scripts/index.js`ã®ã‚³ãƒ¼ãƒ‰ã‚’è¼‰ã›ã¾ã™ã€‚
è©³ã—ãè§£èª¬ã—ãªã„ã§ã™ãŒã€importã—ã¦ã„ã‚‹`GL`ã¯Three.jsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’è¡Œã£ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¹ã§ã€`Blob`ã¯ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãªã©ã§çƒä½“ã¿ãŸã„ãªç‰©ä½“ã‚’ä½œã£ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¹ã§ã™

```js title="scripts/index.js"
// Three.js ã®æç”»å‡¦ç†ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹
import GL from './gl';
// ã‚«ã‚¹ã‚¿ãƒ  Blob ãƒ¡ãƒƒã‚·ãƒ¥ã‚¯ãƒ©ã‚¹
import Blob from './gl/Blog';

import gsap from 'gsap';

class App {
  constructor(pageType) {
    // GLï¼ˆThree.js ã®åˆæœŸåŒ–ã¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ
    this.gl = new GL();

    // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ï¼ˆãƒ‘ã‚¹ï¼‰ã‚’ä¿å­˜
    this.pageType = pageType;

    // Blob ãƒ¡ãƒƒã‚·ãƒ¥ã‚’ä½œæˆ
    this.blob = this.createBlob();
    // Three.js ã®ã‚·ãƒ¼ãƒ³ã« blob ã‚’è¿½åŠ 
    this.gl.scene.add(this.blob);
    // åˆæœŸãƒšãƒ¼ã‚¸ã® blob ã®çŠ¶æ…‹ã‚’è¨­å®šï¼ˆä½ç½®ãƒ»å›è»¢ãƒ»uniformï¼‰
    this.initPage(this.pageType);
  }

  createBlob() {
    // Blob ã®ã‚µã‚¤ã‚ºã€ãƒã‚¤ã‚ºé€Ÿåº¦ã€è‰²ç›¸ã€ãƒã‚¤ã‚ºå‘¨æ³¢æ•°ã€å¯†åº¦ã€å¼·åº¦ã€ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¨­å®š
    return new Blob(1.7, 0.1, 0.7, 1.5, 0.1, Math.PI * 2);
  }

  initPage(type) {
    // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ãƒ‘ã‚¹ã‹ã‚‰è¨­å®šã‚’å–å¾—
    const cfg = this.getSettings(type);

    // åˆæœŸä½ç½®ã¨å›è»¢ã‚’è¨­å®š
    this.blob.position.set(...cfg.pos);
    this.blob.rotation.set(...cfg.rot);

    // Shader ã® uniform å¤‰æ•°ã‚’åˆæœŸåŒ–
    this.blob.material.uniforms.uHue.value = cfg.uniforms.color;
    this.blob.material.uniforms.uNoiseStrength.value = cfg.uniforms.strength;
  }

  setPageType(path) {
    // ãƒšãƒ¼ã‚¸é·ç§»å¾Œã®ãƒ‘ã‚¹ã«åŸºã¥ã„ã¦è¨­å®šã‚’å–å¾—
    const cfg = this.getSettings(path);

    // ä½ç½®ãƒ»å›è»¢ãƒ»uniform ã‚’ GSAP ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã§æ›´æ–°
    gsap.to(this.blob.position, {
      x: cfg.pos[0],
      y: cfg.pos[1],
      z: cfg.pos[2],
      duration: 1.5,
      ease: 'power2.inOut',
    });

    gsap.to(this.blob.rotation, {
      x: cfg.rot[0],
      y: cfg.rot[1],
      z: cfg.rot[2],
      duration: 1.5,
      ease: 'power2.inOut',
    });

    gsap.to(this.blob.material.uniforms.uHue, {
      value: cfg.uniforms.color,
      duration: 1.5,
      ease: 'power2.inOut',
    });

    gsap.to(this.blob.material.uniforms.uNoiseStrength, {
      value: cfg.uniforms.strength,
      duration: 1.5,
      ease: 'power2.inOut',
    });
  }

  getSettings(path) {
    // Astro ã® base ãƒ‘ã‚¹ã‚’å–å¾—ï¼ˆGitHub Pages ãªã©ã§å¯¾å¿œï¼‰
    const base = import.meta.env.BASE_URL;

    // baseURL ã‚’é™¤å»ã—ã¦ç´”ç²‹ãªãƒšãƒ¼ã‚¸ãƒ‘ã‚¹ã‚’å–å¾—
    let type = path.replace(base, '');

    // /member/xxxx ã®ã‚ˆã†ãªè©³ç´°ãƒšãƒ¼ã‚¸ã‚‚ /member ã¨ã—ã¦å‡¦ç†
    if (type.startsWith('/member')) {
      type = '/member';
    }

    // ãƒ‘ã‚¹ã”ã¨ã® Blob ã®çŠ¶æ…‹ï¼ˆä½ç½®ãƒ»å›è»¢ãƒ»uniformï¼‰ã‚’å®šç¾©
    let settings;
    switch (type) {
      case '/about/':
        settings = {
          pos: [-2.8, 0.3, 2],
          rot: [0.1, 0.5, 0],
          uniforms: { color: 0.4, strength: 0.5 },
        };
        break;
      case '/member':
        settings = {
          pos: [-1.5, 2.0, -0.5],
          rot: [0, 0, 0],
          uniforms: { color: 0.6, strength: 0.2 },
        };
        break;
      case '/':
        settings = {
          pos: [2.8, -0.8, 1],
          rot: [-0.4, 0, -0.5],
          uniforms: { color: 0.7, strength: 0.1 },
        };
        break;
    }
    return settings;
  }
}

let app;

// åˆæœŸåŒ–ã¾ãŸã¯ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã«å‘¼ã°ã‚Œã‚‹é–¢æ•°
function initOrUpdateApp() {
  const path = window.location.pathname;

  // åˆå›ã®ã¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã€ãã‚Œä»¥é™ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆ
  if (!app) {
    app = new App(path);
  } else {
    app.setPageType(path);
  }
}

// Astro ã®ãƒšãƒ¼ã‚¸é·ç§»ã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾å¿œï¼ˆView Transitions å¯¾å¿œï¼‰
document.addEventListener('astro:after-swap', initOrUpdateApp);
document.addEventListener('astro:page-load', initOrUpdateApp);
```

Astroã§View Transitionsã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ãªloadã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒåŠ¹ã‹ãªããªã‚Šã¾ã™ã€‚

```js
window.addEventListener('load', () => {
  // View Transitionsã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ç™ºç«ã—ãªã„
  initOrUpdateApp();
})
```

ãã®ãŸã‚ã€View Transitionsã‚’æœ‰åŠ¹ã«ã—ãŸçŠ¶æ…‹ã§loadã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã•ã›ã‚‹ãŸã‚ã«ã€`astro:page-load`ã‚¤ãƒ™ãƒ³ãƒˆã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

ã¾ãŸã€`astro:after-swap`ã‚¤ãƒ™ãƒ³ãƒˆã¯æ–°ã—ã„ãƒšãƒ¼ã‚¸ãŒå¤ã„ãƒšãƒ¼ã‚¸ã‚’ç½®ãæ›ãˆãŸç›´å¾Œã«ç™ºç«ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã§ã™ã€‚View Transitionsã‚’æœ‰åŠ¹ã«ã—ãŸçŠ¶æ…‹ã§JavaScriptã‚’å®Ÿè¡Œã—ãŸã„å ´åˆã¯ã“ã¡ã‚‰ã‚‚åˆ©ç”¨ã—ã¾ã—ã‚‡ã†ã€‚

```js
let app;

// åˆæœŸåŒ–ã¾ãŸã¯ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã«å‘¼ã°ã‚Œã‚‹é–¢æ•°
function initOrUpdateApp() {
  const path = window.location.pathname;

  // åˆå›ã®ã¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã€ãã‚Œä»¥é™ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆ
  if (!app) {
    app = new App(path);
  } else {
    app.setPageType(path);
  }
}

// Astro ã®ãƒšãƒ¼ã‚¸é·ç§»ã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾å¿œï¼ˆView Transitions å¯¾å¿œï¼‰
document.addEventListener('astro:after-swap', initOrUpdateApp);
document.addEventListener('astro:page-load', initOrUpdateApp);
```

ã‚³ãƒ¼ãƒ‰ã®ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç°¡å˜ã«èª¬æ˜ã™ã‚‹ã¨ã€ãƒšãƒ¼ã‚¸ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦åˆå›ã®ã¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚`initPage`ã§åˆæœŸãƒšãƒ¼ã‚¸ã®Blobã®çŠ¶æ…‹ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚å„ãƒšãƒ¼ã‚¸ã®Blobã®çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

`getSettings`ã§ã¯ãƒšãƒ¼ã‚¸ãƒ‘ã‚¹ã«å¿œã˜ã¦Blobã®çŠ¶æ…‹ã‚’è¨­å®šã—ã¾ã™ã€‚ã€Œ/member/[id]ã€ã®ã‚ˆã†ãªè©³ç´°ãƒšãƒ¼ã‚¸ã‚‚memberãƒšãƒ¼ã‚¸ã¨ã—ã¦å‡¦ç†ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ãƒšãƒ¼ã‚¸ã”ã¨ã®ãƒšãƒ¼ã‚¸é·ç§»ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€x,y,zã®ä½ç½®ã¨ã€å›è»¢ã®x,y,zã®å€¤ã€è‰²ã¨ãƒã‚¤ã‚ºå¼·åº¦ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ãƒšãƒ¼ã‚¸é·ç§»ã—ãŸã¨ãã«`setPageType`ãŒå‘¼ã°ã‚Œã€gsapã‚’ç”¨ã„ã¦ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã®Blobã®çŠ¶æ…‹ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã§æ›´æ–°ã—ã¾ã™ã€‚

ã“ã‚Œã§ã€Three.jsã®ç‰©ä½“ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºã«ãƒšãƒ¼ã‚¸é·ç§»ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ãã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

<PostAdUnit />

## ã¾ã¨ã‚

Astronã®View Transitionsã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚ãƒ†ã‚­ã‚¹ãƒˆã®å‡ºã—å…¥ã‚Œã®è‡ªç”±ã•ã‚„ã€ç”»åƒã®ã‚¹ãƒ ãƒ¼ã‚ºãªç§»å‹•ãŒJavaScriptã‚’ä½¿ã‚ãšã«CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿç¾ã§ãã‚‹ã®ã¯ä¾¿åˆ©ã§ã™ã­ã€‚

ã¾ãŸThree.jsã‚’ä½¿ã£ã¦ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºãªãƒšãƒ¼ã‚¸é·ç§»ãŒã§ãã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚swupã‚„barba.jsãªã©ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’ä½¿ã‚ãªãã¦ã‚‚ãƒªãƒƒãƒãªãƒšãƒ¼ã‚¸é·ç§»ãŒã§ãã‚‹ã®ã¯å¬‰ã—ã„ã§ã™ã€‚

ä»Šå¾Œã€WebGLã‚’ä½¿ã£ãŸãƒªãƒƒãƒãªè¡¨ç¾ã«æŒ‘æˆ¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã—ãŸï¼

ã“ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

## å‚è€ƒ

- Astroå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
[View transitions - Astro](https://docs.astro.build/en/guides/view-transitions/)

- Three.jsã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãªã©å‚è€ƒ
[Twisted Colorful Spheres with Three.js](https://tympanus.net/codrops/2021/01/26/twisted-colorful-spheres-with-three-js/)

- View Transitionsã¨Three.jsã®ãƒ¢ãƒ‡ãƒ«ã®çµ„ã¿åˆã‚ã›æ–¹ã®å‚è€ƒãƒªãƒã‚¸ãƒˆãƒª
[astro-3d-view-transitions](https://github.com/Charca/astro-3d-view-transitions/tree/main)

- View Transitions APIã®å‚è€ƒ01
[Astro View Transitions](https://developer.chrome.com/blog/astro-view-transitions?hl=ja)

- View Transitions APIã®å‚è€ƒ02
[ï¼œAstro3.0ï¼View Transition APIã‚’ã‚µãƒãƒ¼ãƒˆï¼ãƒšãƒ¼ã‚¸é–“ã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ãŒç°¡å˜å®Ÿè£…å¯èƒ½ã«ï¼](https://cumak.net/blog/astro-view-transition/)